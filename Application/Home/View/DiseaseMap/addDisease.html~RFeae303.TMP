<block name="title"><title>添加地图疾病</title></block>
<include file="comment/header" />
<script type="text/javascript">
var mapObj;
var lng=0;
var lat=0;
var marker;
//删除点
var arrOverlays=new Array();
var  opt = { 
		level:3//初始地图视野级别 
}
arrOverlays.push('marker');



function addContentMenu(){
	//构造 ContextMenu 新实例
	var contextMenu = new MMap.ContextMenu({
		isCustom:false,
		width:180,
		
	});
	//添加菜单项

	contextMenu.addItem("在此处添加标注",function(e){
		var marker=new MMap.Marker({
			icon:"http://code.mapabc.com/images/lan_1.png",
			offset:new MMap.Pixel(-11.5,-32), 
			position:xy
		});
		mapObj.addOverlays(marker);

	},2);
	//绑定右键单击事件，打开右键菜单
	mapObj.bind(mapObj,"rightclick",fun5=function(e){
		lng =e.lnglat.lng;
		lat =e.lnglat.lat;
		var arr= new Array();
		marker=new MMap.Marker({
			id:"marker",						  
			icon:"http://code.mapabc.com/images/lan_1.png",
			position:new MMap.LngLat(lng,lat)
			});
		arr.push(marker);
		mapObj.addOverlays(arr);

		// contextMenu.open(mapObj,e.lnglat);

		// mapObj.removeOverlays(arrOverlays);
	});
}

$(function(){
	mapObj = new MMap.Map("iCenter",opt);
	addContentMenu();
//提交设置
	$("#submit").click(function(){
		
		if (lng ==0 || lat==0 ) {
			alert('请选择城市');
			return false;
		};
		alert(marker.getPosition());
		lng = marker.getPosition().split(',')[0];
		lat = marker.getPosition().split(',')[1];
		var cityname	= $("input[name='city']").val();
		var	diseasename	= $("input[name='title']").val();
		var start		= $("input[name='start']").val();
		var end			= $("input[name='end']").val();
		var mnum		= $("input[name='mnum']").val();
		var ratio		= $("input[name='ratio']").val();
		var comment		= $("#diseasecom").val();
		if(!cityname){
			alert('请输入城市名称');
			return false;
		}
		if(!diseasename){
			alert('请输入疾病名称');
			return false;
		}
		if(!start){
			alert('请输入起始时间');
			return false;
		}
		if(!end){
			alert('请输入结束时间');
			return false;
		}
		if(!end){
			alert('请输入结束时间');
			return false;
		}
		if(!mnum){
			alert('请输入发病人数');
			return false;
		}
		if(!comment){
			alert('请输入描述');
			return false;
		}
		$.post("/Home/diseaseMap/addInfo",
			{ cityname: cityname, diseasename: diseasename ,start: start,end: end,mnum: mnum,ratio: ratio, comment:comment,lng:lng,lat:lat},
   					function(data){
    				//var data = eval("("+data+")");
    				if(data.code ==1){
    					lng=0;
						lat=0;
						$("input[type!='button']").val('');
						$("#diseasecom").val('');
						mapObj.removeOverlays(arrOverlays);
    				}
    				alert(data.msg);
   		});
	});	
});
	
</script>

<table width='100%'  border="0" cellpadding="0" cellspacing="2" height='100%'>
	<tr>
		<td  style="width:77%;height:100%;"><div id="iCenter" style="height:100%; width:100%"></div></td>
		<td>
			<table>
				<tr>
					<td>城市：</td>
					<td><input type="text" name='city'></td>
				</tr>
				<tr>
					<td>疾病名称</td>
					<td><input type="text" name='title'></td>
				</tr>
				<tr>
					<td>发病起始于</td>
					<td><input type="text" name='start'></td>
				</tr>
				<tr>
					<td>结束于</td>
					<td><input type="text" name='end'></td>
				</tr>
				<tr>
					<td>发病人数</td>
					<td><input type="text" name='mnum'></td>
				</tr>
				<tr>
					<td>发病率</td>
					<td><input type="text" name='ratio'></td>
				</tr>
				<tr>
					<td colspan="2">备注：</td>
				</tr>
				<tr>
					<td colspan="2"><textarea name="comment" id="diseasecom"></textarea></td>
				</tr>
			</table>
			<input type="button" id="submit" value="提交">
		</td>
	</tr>
</table>

<include file="comment/footer" />